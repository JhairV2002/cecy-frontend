<p-dialog
  header="Usuario"
  [(visible)]="dialogForm"
  [maximizable]="true"
  [modal]="true"
>
  <app-instructor-form
    *ngIf="dialogForm"
    (dialogForm)="dialogForm = $event"
  ></app-instructor-form>
</p-dialog>

<p-dialog
  header="Asignar como instructores"
  [(visible)]="dialogLists"
  [maximizable]="true"
  [modal]="true"
>
  <app-assignment-instructors-form
    *ngIf="dialogLists"
    (dialogLists)="dialogLists = $event"
  ></app-assignment-instructors-form>
</p-dialog>

<div class="container">
  <p-toolbar>
    <div class="p-toolbar-group-left">
      <button
        pButton
        pRipple
        type="button"
        label="Crear instructor"
        class="p-button-success p-button-rounded"
        icon="pi pi-plus"
        (click)="showForm()"
      ></button>
      <button
        pButton
        pRipple
        type="button"
        label="Asignar instructores"
        class="p-button-success p-button-rounded ml-2"
        icon="pi pi-plus"
        (click)="showUsers()"
      ></button>
      <button
        pButton
        pRipple
        type="button"
        label="Refrescar"
        class="p-button-rounded ml-2"
        icon="pi pi-sync"
        (click)="loadInstructors(paginator.current_page)"
      ></button>
      <button
        *ngIf="selectedInstructors?.length"
        pButton
        pRipple
        type="button"
        label="Eliminar seleccionados"
        class="p-button-danger p-button-rounded ml-2"
        icon="pi pi-trash"
        (click)="deleteInstructors()"
      ></button>
      <app-progress-bar
        *ngIf="progressBarDelete"
        [message]="messageService.progressBarDelete"
        class="ml-2"
      >
      </app-progress-bar>
    </div>
    <div class="p-toolbar-group-right">
      <div class="p-inputgroup">
        <input
          pInputText
          id="search"
          [formControl]="search"
          (keypress)="filter($event)"
        />
        <button
          pButton
          pRipple
          type="button"
          icon="pi pi-search"
          (click)="filter($event)"
        ></button>
      </div>
    </div>
  </p-toolbar>
  <p-card>
    <p-paginator
      [rows]="paginator.per_page!"
      [totalRecords]="paginator.total!"
      (onPageChange)="paginate($event)"
    >
    </p-paginator>
    <p-table
      dataKey="id"
      styleClass="p-datatable-striped"
      [value]="(instructors$ | async)?.data"
      [columns]="cols"
      [loading]="(loaded$ | async)!"
      [(selection)]="selectedInstructors"
      [responsive]="true"
    >
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field">
            {{ col.header }}
            <p-sortIcon [field]="col.field"></p-sortIcon>
          </th>
          <th class="text-center">
            <button
              pButton
              pRipple
              type="button"
              class="p-button-rounded p-button-secondary"
              icon="pi pi-cog"
            ></button>
          </th>
        </tr>
      </ng-template>
      <ng-template
        pTemplate="body"
        let-rowData
        let-columns="columns"
        let-rowIndex="rowIndex"
      >
        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
          <td>
            <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
          </td>

          <td>
            {{ rowData["id"] }}
          </td>
          <td>
            {{ rowData["user"] ? rowData["user"].username : "NULL" }}
          </td>
          <td>
            {{ rowData["user"] ? rowData["user"].name : "NULL" }}
          </td>
          <td>
            {{ rowData["user"] ? rowData["user"].lastname : "NULL" }}
          </td>
          <td>
            {{ rowData["state"] ? rowData["state"].name : "NULL" }}
          </td>
          <td>
            {{ rowData["type"] ? rowData["type"].name : "NULL" }}
          </td>

          <td class="text-center">
            <p-splitButton
              label="MÃ¡s"
              styleClass="p-button-secondary"
              icon="pi pi-instructor-edit"
              (onClick)="showForm(rowData)"
              (onDropdownClick)="selectInstructor(rowData)"
              [model]="items"
            >
            </p-splitButton>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="summary">
        {{ messageService.paginatorTotalRegisters(paginator) }}
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length">
            {{ messageService.paginatorNoRecordsFound }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

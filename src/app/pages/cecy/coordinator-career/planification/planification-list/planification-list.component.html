<app-planification-form
  [showModal]="isVisible"
  [selectPlanification]="selectPlanification"
  (clickClose)="closeModal($event)"
  (addPlanification)="addPlanification($event)"
  [selectedCareer]="selectedCareer"
></app-planification-form>
<h1 class="text-center font-bold text-xl">{{ nameCareer }}</h1>
<p-toolbar>
  <div class="p-toolbar-group-left">
    <input
      pInputText
      id="search"
      [formControl]="search"
      placeholder="Buscar por nombre curso"
    />
    <!-- (keypress)="filter($event)" -->
    <button pButton pRipple type="button" icon="pi pi-search"></button>
    <!-- (click)="filter($event)" -->
    <div class="ml-3">
      <p-button
        *ngIf="activeButton"
        type="button"
        icon="pi pi-plus"
        styleClass="p-button-success p-button-rounded ml-2"
        pTooltip="Crear nueva planificación del curso"
        (click)="showForm()"
      ></p-button>
    </div>

    <i
      class="p-toolbar-separator pi pi-bars mr-2"
      style="vertical-align: middle"
    ></i>
    <!-- [loading]="loading[0]" -->
    <p-button
      type="button"
      pTooltip="Refrescar"
      styleClass="p-button-primary p-button-rounded ml-2"
      icon="pi pi-sync"
      (click)="loadCoursesByCareer()"
    ></p-button>
    <p-button
      *ngIf="selectedCourses?.length"
      type="button"
      pTooltip="Eliminar seleccionados"
      tooltipPosition="bottom"
      styleClass="p-button-danger p-button-rounded ml-4"
      icon="pi pi-trash"
    ></p-button>
    <!-- (click)="deleteCourses()" -->
    <app-progress-bar
      *ngIf="progressBarDelete"
      [message]="messageService.progressBarDelete"
      class="ml-2"
    >
    </app-progress-bar>
  </div>
  <p-chip styleClass="mr-4">
    <i class="bi bi-file-earmark-break mr-2"></i>
    <small
      >Planificaciones Total:
      {{ planificationCourses ? planificationCourses.length : 0 }}
    </small></p-chip
  >
  <div class="p-toolbar-group-right">
    <p-dropdown
      [formControl]="career"
      [(ngModel)]="selectedCareer"
      [options]="careers"
      placeholder="Seleccione una carrera"
      class="ml-2"
      [style]="{ width: '260px' }"
      optionValue="id"
      optionLabel="name"
      (onChange)="onchange($event)"
    >
    </p-dropdown>
  </div>
</p-toolbar>

<!-- <p-toolbar>
  <app-initial-planification-kpi></app-initial-planification-kpi>
</p-toolbar> -->

<p-card>
  <p-table
    *ngIf="selectCareer"
    dataKey="id"
    [columns]="cols"
    [responsive]="true"
    [value]="planificationCourses"
    [paginator]="true"
    [rows]="5"
    [loading]="isLoadingPlanification"
  >
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th id="" style="width: 3rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        <th id="" *ngFor="let col of columns" [pSortableColumn]="col.field">
          {{ col.header }}
          <p-sortIcon [field]="col.field"></p-sortIcon>
        </th>
        <th class="text-center">
          <button
            pButton
            pRipple
            type="button"
            class="p-button-rounded p-button-secondary"
            icon="pi pi-cog"
          ></button>
        </th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-planification
      let-columns="columns"
      let-rowIndex="rowIndex"
    >
      <tr [pSelectableRow]="planification" [pSelectableRowIndex]="rowIndex">
        <td>
          <p-tableCheckbox [value]="planification"></p-tableCheckbox>
        </td>
        <td>{{ planification.codeCourse }}</td>
        <td>{{ planification.name }}</td>
        <td>{{ planification.durationTime }}</td>
        <td>
          {{ planification.user.names }} {{ planification.user.lastnames }}
        </td>
        <td>
          <p-tag
            [icon]="
              planification.state === 'aprobado' ? 'pi pi-check' : 'pi pi-clock'
            "
            [rounded]="true"
            value="{{ planification.state }}"
            [severity]="getSeverity(planification.state)"
          >
          </p-tag>
        </td>

        <td>
          <div class="flex gap-1 justify-content-center">
            <button
              pButton
              icon="pi pi-trash"
              class="p-button-rounded p-button-danger"
              type="submit"
              (click)="deletePlanification(planification)"
            ></button>
            <button
              pButton
              pRipple
              type="button"
              icon="pi pi-pencil"
              class="p-button-rounded p-button-warning"
              (click)="editPlanification(planification)"
            ></button>
          </div>
        </td>
        <!--Fields-->
        <!-- <div *ngIf="!rowData[col.field]?.id" [ngSwitch]="col.field">
              <div *ngSwitchDefault>{{ rowData[col.field] }}</div>
            </div> -->
        <!-- </td> -->

        <!-- DDRC-C: columna de acciones -->
        <!-- <span [ngSwitch]="planification['state']['code']"> -->
        <!-- <td
              class="text-center"
              style="background-color: transparent !important"
              *ngSwitchCase="'TO_BE_APPROVED'"
            >
              <div
                class="flex flex-row justify-content-center align-items-center justify-content-center"
              >
                <p-button
                  type="button"
                  pTooltip="Actualizar Curso"
                  styleClass="p-button-sm p-button-warning p-button-rounded"
                  icon="pi pi-user-edit"
                  (click)="showForm()"
                ></p-button>
                <p-button
                  type="button"
                  pTooltip="Ver planificaciones"
                  styleClass="p-button-sm ml-1 p-button-secondary p-button-rounded"
                  icon="pi pi-eye"
                  (click)="goToPlanifications(planification)"
                ></p-button>
                <p-button
                  type="button"
                  pTooltip="Borrar curso"
                  styleClass="p-button-sm ml-1 p-button-danger p-button-rounded"
                  icon="pi pi-trash"
                  (click)="deleteCourse(planification)"
                ></p-button>
              </div>
            </td> -->
        <!-- <td class="text-center" *ngSwitchCase="'NOT_APPROVED'">
              <p-button
                type="button"
                pTooltip="Actualizar Curso"
                tooltipPosition="bottom"
                class="p-button-warning p-button-rounded ml-2"
                icon="pi pi-user-edit"
                (click)="showForm()"
              ></p-button>
              <button
                pButton
                pRipple
                type="button"
                pTooltip="Ver planificaciones"
                tooltipPosition="bottom"
                class="p-button-secondary p-button-rounded ml-2"
                icon="pi pi-eye"
              ></button>
              <!-- (click)="goToPlanifications(planification)" -->
        <!-- <button
                pButton
                pRipple
                type="button"
                pTooltip="Borrar curso"
                tooltipPosition="bottom"
                class="p-button-danger p-button-rounded ml-2"
                icon="pi pi-trash"
              ></button> -->
        <!-- (click)="deleteCourse(planification)" -->
        <!-- </td> -->
        <!--             <td class="text-center"> -->
        <!-- <button
                pButton
                pRipple
                type="button"
                pTooltip="Ver planificaciones"
                tooltipPosition="bottom"
                class="p-button-secondary p-button-rounded ml-2"
                icon="pi pi-eye"
              ></button> -->
        <!-- (click)="goToPlanifications(planification)" -->
        <!--             </td> -->
        <!--  </span> -->
      </tr>
    </ng-template>
    <ng-template pTemplate="summary">
      <div class="flex align-items-center justify-content-between">
        Actualmente hay
        {{ planificationCourses ? planificationCourses.length : 0 }}
        planificaciones
      </div>
    </ng-template>
  </p-table>
  <p *ngIf="!selectCareer" class="text-center information text-xl">
    No tiene planificaciones, seleccione una carrera para <br />
    empezar y agregue una nueva planificación!
  </p>
</p-card>

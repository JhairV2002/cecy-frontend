<p-dialog [header]="dialogHeader" [(visible)]="dialogForm" [maximizable]="true" [modal]="true" [style]="{width: '80vw'}"
  (onHide)="loadDetailPlanifications()">
  <app-detail-planification-form *ngIf="dialogForm" [data]=selectedDetailPlan [planId]=planId (dialogForm)="dialogForm=$event">
  </app-detail-planification-form>
</p-dialog>

<p-dialog header="Instructores" [(visible)]="dialogList" [maximizable]="true" [modal]="true" (onHide)="loadDetailPlanifications()">
  <app-assignment-instructors-form *ngIf="dialogList" (dialogList)="dialogList=$event">
  </app-assignment-instructors-form>
</p-dialog>

<div class="container">
  <div class="text-center">
    <h5>Horarios</h5>
  </div>
  <p-toolbar>
    <div class="p-toolbar-group-left">
      <button pButton pRipple type="button" label="Nuevo Horario" class="p-button-success p-button-rounded"
        icon="pi pi-plus" (click)="showForm()"></button>
      <button pButton pRipple type="button" label="Refrescar" class="p-button-rounded ml-2" icon="pi pi-sync"
        (click)="loadDetailPlanifications(paginator.current_page)"></button>
      <button *ngIf="selectedDetailPlanifications?.length!=0" pButton pRipple type="button" label="Eliminar seleccionados"
        class="p-button-danger p-button-rounded ml-2" icon="pi pi-trash"
        (click)="deleteDetailPlanifications()"></button>
    </div>

  </p-toolbar>
  <p-card>
    <p-paginator [rows]="paginator.per_page!"
                 [totalRecords]="paginator.total!"
                 (onPageChange)="paginate($event)">
    </p-paginator>
    <p-table dataKey="id" styleClass="p-datatable-striped" [value]="detailPlanifications" [columns]="cols"
      [(selection)]="selectedDetailPlanifications" [responsive]="true">
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field">
            {{col.header}}
            <p-sortIcon [field]="col.field"></p-sortIcon>
          </th>
          <th class="text-center">
            <button pButton pRipple type="button" class="p-button-rounded p-button-secondary" icon="pi pi-cog"></button>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
          <td>
            <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
          </td>
          <td>
            {{rowData['startedTime']}}-{{rowData['endedTime']}}

          </td>
          <td>
            {{rowData['day'].name}}
          </td>
          <!-- <td>
            {{rowData['workday'].name}}
          </td> -->
          <td>
            {{rowData['classroom'].name}}
          </td>
          <td>
            {{rowData['parallel'].name}}
          </td>
          <td>
            <ul>
              <li *ngFor="let instructor of rowData['instructors']">
                {{instructor?.user?.fullname}}
              </li>
            </ul>
          </td>
          <td>
            {{rowData['observation']}}
          </td>

          <!-- <div [ngSwitch]="rowData['state'].name">
            <td *ngSwitchCase="'APROBADO'">
              <span class="badge bg-primary rounded-pill">{{rowData['state'].name}}</span>
            </td>
            <td *ngSwitchCase="'NO APROBADO'">
              <span class="badge bg-danger rounded-pill">{{rowData['state'].name}}</span>
            </td>
            <td *ngSwitchCase="'POR APROBAR'">
              <span class="badge bg-warning rounded-pill">{{rowData['state'].name}}</span>
            </td>
            <td *ngSwitchCase="'CULMINADO'">
              <span class="badge bg-success rounded-pill">{{rowData['state'].name}}</span>
            </td>
            <td *ngSwitchDefault>
              {{rowData['state'].name}}
            </td>
          </div> -->

          <td>
            <p-splitButton label="Editar" styleClass="p-button-secondary" icon="pi pi-pencil"
              (onClick)="showForm(rowData)" (onDropdownClick)="selectDetailPlanification(rowData)" [model]="items">
            </p-splitButton>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="summary">
        {{messageService.paginatorTotalRegisters(paginator)}}
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length">
            {{messageService.paginatorNoRecordsFound}}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>


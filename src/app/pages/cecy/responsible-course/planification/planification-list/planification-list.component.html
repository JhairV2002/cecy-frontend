<p-dialog header="Horarios" [(visible)]="dialogForm" [maximizable]="true" [modal]="true">
  <!-- <app-detail-planification-form *ngIf="dialogForm" (dialogForm)="dialogForm=$event"></app-detail-planification-form> -->
  <app-detail-planification-list *ngIf="dialogForm" (dialog)="dialogForm=$event"></app-detail-planification-list>
</p-dialog>

<div class="container-fluid">
  <div class="text-center">
    <h4>Mis Planificaciones</h4>
  </div>
  <p-toolbar>
    <div class="p-toolbar-group-left">
      <button pButton pRipple
              type="button"
              label="Refrescar"
              class="p-button-rounded ml-2"
              icon="pi pi-sync"
              (click)="loadPlanifications(paginator.current_page)"></button>
    </div>
    <div class="p-toolbar-group-right">
      <app-kpi [data]="planifications" [model]="kpiModel"></app-kpi>
    </div>

  </p-toolbar>
  <div class="container">
    <br>
    <p-card>
      <div class="p-fluid">
        <p-paginator [rows]="paginator.per_page!"
                     [totalRecords]="paginator.total!"
                     (onPageChange)="paginate($event)">
        </p-paginator>
        <p-table dataKey="id" styleClass="p-datatable-striped" [value]="planifications" [columns]="cols"
          [loading]="(loaded$|async)!" [(selection)]="selectedPlanifications" [responsive]="true">
          <ng-template pTemplate="header" let-columns>
            <tr>
              <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                {{col.header}}
                <p-sortIcon [field]="col.field"></p-sortIcon>
              </th>
              <th class="text-center">
                <button pButton pRipple type="button" class="p-button-rounded p-button-secondary"
                  icon="pi pi-cog"></button>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
            <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">

              <!-- <td>
                {{rowData['code']}}
              </td> -->
              <!-- <td>
                {{rowData['responsibleCourse'].user?.fullname}}
              </td> -->
              <td>
                {{rowData['detailSchoolPeriod']['schoolPeriod'].code}}
              </td>
              <td>
                {{rowData['startedAt']}}
              </td>
              <td>
                {{rowData['endedAt']}}
              </td>
              <!-- <td>
                <ul>
                  <li *ngFor="let participantType of rowData['course'].participantTypes">
                    {{participantType.name}}
                  </li>
                </ul>
              </td> -->
              <!-- <td>
                <div *ngFor="let detailPlanification of rowData['detailPlanifications']">
                  <ul>
                    <li *ngFor="let instructor of detailPlanification.instructors">
                      {{instructor?.user?.fullname}}
                    </li>
                  </ul>
                </div>
              </td> -->

              <div [ngSwitch]="rowData['state'].name">
                <td *ngSwitchCase="'APROBADO'">
                  <span class="badge bg-primary rounded-pill">{{rowData['state'].name}}</span>
                </td>
                <td *ngSwitchCase="'NO APROBADO'">
                  <span class="badge bg-danger rounded-pill">{{rowData['state'].name}}</span>
                </td>
                <td *ngSwitchCase="'POR APROBAR'">
                  <span class="badge bg-warning rounded-pill">{{rowData['state'].name}}</span>
                </td>
                <td *ngSwitchCase="'CULMINADO'">
                  <span class="badge bg-success rounded-pill">{{rowData['state'].name}}</span>
                </td>
                <td *ngSwitchDefault>
                  {{rowData['state'].name}}
                </td>
              </div>

              <td class="text-center">
                <!-- <p-button icon="pi pi-pencil" (onClick)="editPlanification(rowData)"></p-button> -->
                <p-splitButton
                              label="MÃ¡s"
                              styleClass="p-button-secondary"
                              (onDropdownClick)="selectPlanification(rowData)"
                              styleClass="p-button-warning mb-2"
                              [model]="items"
                              (onClick)="selectPlanification(rowData)"
                              >

                </p-splitButton>

              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="summary">
            {{messageService.paginatorTotalRegisters(paginator)}}
          </ng-template>
          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
              <td [attr.colspan]="columns.length">
                {{messageService.paginatorNoRecordsFound}}
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-card>
  </div>
</div>
